@page "{id:guid}"
@model FixHub.Web.Pages.Technicians.ProfileModel
@{
    ViewData["Title"] = Model.Profile?.FullName ?? "Perfil técnico";
}

@if (Model.Profile is null)
{
    <div class="alert alert-danger">Perfil no encontrado.</div>
}
else
{
    var p = Model.Profile;
    var rating = (double)p.AvgRating;
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card shadow-sm fixhub-rep-card">
                <div class="card-body">
                    <div class="d-flex flex-wrap align-items-start gap-3">
                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center flex-shrink-0"
                             style="width:64px;height:64px;font-size:1.5rem;font-weight:700">
                            @p.FullName[0]
                        </div>
                        <div class="flex-grow-1 min-w-0">
                            <h2 class="h4 mb-1 fixhub-section-title">@p.FullName</h2>
                            <p class="fixhub-rep-meta mb-2">@p.Email</p>
                            <div class="d-flex flex-wrap align-items-center gap-3 mt-2">
                                <span class="fixhub-rep-rating-value" style="font-size:1.5rem">@p.AvgRating.ToString("N1")</span>
                                <span class="fixhub-stars fixhub-stars-lg"><partial name="_Stars" model="@rating" /></span>
                                <span class="fixhub-rep-meta">@p.CompletedJobs trabajos completados</span>
                                @if (p.IsVerified)
                                {
                                    <span class="badge badge-verified">✔ Técnico verificado</span>
                                }
                            </div>
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(p.Bio))
                    {
                        <hr class="my-3" />
                        <p class="mb-0">@p.Bio</p>
                    }
                    <div class="row g-2 text-center mt-3">
                        <div class="col-4">
                            <div class="border rounded py-2">
                                <div class="fw-bold text-primary">@p.AvgRating.ToString("N1")</div>
                                <div class="small fixhub-text-muted">Calificación</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded py-2">
                                <div class="fw-bold text-success">@p.CompletedJobs</div>
                                <div class="small fixhub-text-muted">Completados</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded py-2">
                                <div class="fw-bold text-info">@p.ServiceRadiusKm km</div>
                                <div class="small fixhub-text-muted">Radio</div>
                            </div>
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(p.Phone))
                    {
                        <p class="mt-3 mb-0 small"><strong>Teléfono:</strong> @p.Phone</p>
                    }
                    @if (p.CancelRate > 0)
                    {
                        <p class="mb-0 small"><strong>Tasa cancelación:</strong> @((p.CancelRate * 100).ToString("N1"))%</p>
                    }
                </div>
                <div class="card-footer bg-transparent border-top">
                    <a asp-page="/Jobs/Index" class="btn btn-outline-secondary btn-sm">Volver</a>
                </div>
            </div>
        </div>
    </div>
}
